<!DOCTYPE html>
<!--********************************************-->
<!--*       Generated from PreTeXt source      *-->
<!--*                                          *-->
<!--*         https://pretextbook.org          *-->
<!--*                                          *-->
<!--********************************************-->
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>NetSci Modularity</title>
<meta name="Keywords" content="Authored in PreTeXt">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script>window.MathJax = {
  tex: {
    inlineMath: [['\\(','\\)']],
    tags: "none",
    useLabelIds: true,
    tagSide: "right",
    tagIndent: ".8em",
    packages: {'[+]': ['base', 'extpfeil', 'ams', 'amscd', 'newcommand', 'knowl']}
  },
  options: {
    ignoreHtmlClass: "tex2jax_ignore",
    processHtmlClass: "has_am",
  },
  chtml: {
    scale: 0.88,
    mtextInheritFont: true
  },
  loader: {
    load: ['input/asciimath', '[tex]/extpfeil', '[tex]/amscd', '[tex]/newcommand', '[pretext]/mathjaxknowl3.js'],
    paths: {pretext: "https://pretextbook.org/js/lib"},
  },
};
</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><script xmlns:svg="http://www.w3.org/2000/svg" src="https://pretextbook.org/js/lib/jquery.min.js"></script><script xmlns:svg="http://www.w3.org/2000/svg" src="https://pretextbook.org/js/lib/jquery.sticky.js"></script><script xmlns:svg="http://www.w3.org/2000/svg" src="https://pretextbook.org/js/lib/jquery.espy.min.js"></script><script xmlns:svg="http://www.w3.org/2000/svg" src="https://pretextbook.org/js/0.13/pretext.js"></script><script xmlns:svg="http://www.w3.org/2000/svg" src="https://pretextbook.org/js/0.13/pretext_add_on.js"></script><script xmlns:svg="http://www.w3.org/2000/svg" src="https://pretextbook.org/js/lib/knowl.js"></script><!--knowl.js code controls Sage Cells within knowls--><script xmlns:svg="http://www.w3.org/2000/svg">sagecellEvalName='Evaluate (Sage)';
</script><link xmlns:svg="http://www.w3.org/2000/svg" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,600,600italic" rel="stylesheet" type="text/css">
<link xmlns:svg="http://www.w3.org/2000/svg" href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css">
<link xmlns:svg="http://www.w3.org/2000/svg" href="https://pretextbook.org/css/0.31/pretext.css" rel="stylesheet" type="text/css">
<link xmlns:svg="http://www.w3.org/2000/svg" href="https://pretextbook.org/css/0.31/pretext_add_on.css" rel="stylesheet" type="text/css">
<link xmlns:svg="http://www.w3.org/2000/svg" href="https://pretextbook.org/css/0.31/banner_default.css" rel="stylesheet" type="text/css">
<link xmlns:svg="http://www.w3.org/2000/svg" href="https://pretextbook.org/css/0.31/toc_default.css" rel="stylesheet" type="text/css">
<link xmlns:svg="http://www.w3.org/2000/svg" href="https://pretextbook.org/css/0.31/knowls_default.css" rel="stylesheet" type="text/css">
<link xmlns:svg="http://www.w3.org/2000/svg" href="https://pretextbook.org/css/0.31/style_default.css" rel="stylesheet" type="text/css">
<link xmlns:svg="http://www.w3.org/2000/svg" href="https://pretextbook.org/css/0.31/colors_default.css" rel="stylesheet" type="text/css">
<link xmlns:svg="http://www.w3.org/2000/svg" href="https://pretextbook.org/css/0.31/setcolors.css" rel="stylesheet" type="text/css">
<!-- 2019-10-12: Temporary - CSS file for experiments with styling --><link xmlns:svg="http://www.w3.org/2000/svg" href="developer.css" rel="stylesheet" type="text/css">
</head>
<body class="pretext-book has-toc has-sidebar-left">
<a class="assistive" href="#content">Skip to main content</a><div xmlns:svg="http://www.w3.org/2000/svg" id="latex-macros" class="hidden-content" style="display:none">\(\newcommand{\identity}{\mathrm{id}}
\newcommand{\notdivide}{{\not{\mid}}}
\newcommand{\notsubset}{\not\subset}
\newcommand{\lcm}{\operatorname{lcm}}
\newcommand{\gf}{\operatorname{GF}}
\newcommand{\inn}{\operatorname{Inn}}
\newcommand{\aut}{\operatorname{Aut}}
\newcommand{\Hom}{\operatorname{Hom}}
\newcommand{\cis}{\operatorname{cis}}
\newcommand{\chr}{\operatorname{char}}
\newcommand{\Null}{\operatorname{Null}}


\def\Z{\mathbb Z}
\def\R{\mathbb R}
\def\Q{\mathbb Q}
\def\N{{\mathbb N}}
\def\C{\mathbb C}

\def\ba{{\mathbf{a}}}
\def\bb{\mathbf{b}}
\def\bh{{\mathbf{h}}}
\def\bu{{\mathbf{u}}}
\def\bv{{\mathbf{v}}}
\def\bw{{\mathbf{w}}}   
\def\bx{{\mathbf{x}}}
\def\by{\mathbf{y}}    
\def\bone{{\mathbf{1}}}
\def\bzero{\mathbf{0}}

\def\var{{\mbox{var}}}
\def\P{{\mathbb{P}}}
\def\E{{\mathbb{E}}}


\def\cA{{\overline{A}}}

\def\kin{k^{\mathrm{in}}}
\def\kout{k^{\mathrm{out}}}

\newcommand{\indeg}[1]{k^{\mathrm{in}}_{#1}}
\newcommand{\outdeg}[1]{k^{\mathrm{out}}_{#1}}

\tikzset{-&gt;-/.style={decoration={
 markings,
 mark=at position .5 with {\arrow{latex}}},postaction={decorate}}}
\newcommand{\lt}{&lt;}
\newcommand{\gt}{&gt;}
\newcommand{\amp}{&amp;}
\)</div>
<header id="masthead" class="smallbuttons"><div class="banner"><div class="container">
<a id="logo-link" href=""></a><div class="title-container">
<h1 class="heading"><a href="netsci.html"><span class="title">Network Science:</span> <span class="subtitle">Activities and Exercises</span></a></h1>
<p class="byline">Andrew Beveridge</p>
</div>
</div></div>
<nav xmlns:svg="http://www.w3.org/2000/svg" id="primary-navbar" class="navbar"><div class="container">
<div class="navbar-top-buttons">
<button class="sidebar-left-toggle-button button active" aria-label="Show or hide table of contents sidebar">Contents</button><div class="tree-nav toolbar toolbar-divisor-3"><span class="threebuttons"><a id="previousbutton" class="previous-button toolbar-item button" href="randomwalk.html" title="Previous">Prev</a><a id="upbutton" class="up-button button toolbar-item" href="ch-community.html" title="Up">Up</a><a id="nextbutton" class="next-button button toolbar-item" href="communities.html" title="Next">Next</a></span></div>
</div>
<div class="navbar-bottom-buttons toolbar toolbar-divisor-4">
<button class="sidebar-left-toggle-button button toolbar-item active">Contents</button><a class="previous-button toolbar-item button" href="randomwalk.html" title="Previous">Prev</a><a class="up-button button toolbar-item" href="ch-community.html" title="Up">Up</a><a class="next-button button toolbar-item" href="communities.html" title="Next">Next</a>
</div>
</div></nav></header><div class="page">
<div xmlns:svg="http://www.w3.org/2000/svg" id="sidebar-left" class="sidebar" role="navigation"><div class="sidebar-content">
<nav id="toc"><ul>
<li class="link frontmatter"><a href="frontmatter.html" data-scroll="frontmatter"><span class="title">Front Matter</span></a></li>
<li class="link part"><a href="part-networks.html" data-scroll="part-networks"><span class="codenumber">I</span> <span class="title">Analyzing Networks</span></a></li>
<li class="link">
<a href="ch-community.html" data-scroll="ch-community"><span class="codenumber">1</span> <span class="title">Networks and Communities</span></a><ul>
<li><a href="graphs.html" data-scroll="graphs">Graphs and Digraphs</a></li>
<li><a href="randomwalk.html" data-scroll="randomwalk">Random Walks</a></li>
<li><a href="modularity.html" data-scroll="modularity" class="active">Modularity</a></li>
<li><a href="communities.html" data-scroll="communities">Community Detection in Gephi</a></li>
</ul>
</li>
<li class="link">
<a href="ch-power-law.html" data-scroll="ch-power-law"><span class="codenumber">2</span> <span class="title">Power Laws</span></a><ul>
<li><a href="randvar.html" data-scroll="randvar">Discrete Random Variables</a></li>
<li><a href="probdist.html" data-scroll="probdist">Probability Distributions</a></li>
<li><a href="powerlaw.html" data-scroll="powerlaw">Power Laws</a></li>
</ul>
</li>
<li class="link">
<a href="ch-centrality.html" data-scroll="ch-centrality"><span class="codenumber">3</span> <span class="title">Centralities</span></a><ul>
<li><a href="centrality.html" data-scroll="centrality">Centrality Measures</a></li>
<li><a href="algcentrality.html" data-scroll="algcentrality">Algebraic Centrality</a></li>
<li><a href="hits.html" data-scroll="hits">Hubs and Authorities</a></li>
<li><a href="us-airline.html" data-scroll="us-airline">Analyzing the US Airline Network</a></li>
</ul>
</li>
<li class="link part"><a href="part-models.html" data-scroll="part-models"><span class="codenumber">II</span> <span class="title">Modeling Networks</span></a></li>
<li class="link">
<a href="ch-models.html" data-scroll="ch-models"><span class="codenumber">4</span> <span class="title">Random Models for Networks</span></a><ul>
<li><a href="randomgraph.html" data-scroll="randomgraph">Erdos-Renyi Random Graph</a></li>
<li><a href="giantcomp.html" data-scroll="giantcomp">The Emergence of the Giant Component</a></li>
<li><a href="branching.html" data-scroll="branching">The Branching Process</a></li>
<li><a href="pricemodel.html" data-scroll="pricemodel">Price's Model for a Citation Network</a></li>
<li><a href="smallworld.html" data-scroll="smallworld">The Small World Model</a></li>
<li><a href="navsmallworld.html" data-scroll="navsmallworld">Navigable Small World Model</a></li>
</ul>
</li>
<li class="link">
<a href="ch-processes.html" data-scroll="ch-processes"><span class="codenumber">5</span> <span class="title">Processes on Networks</span></a><ul>
<li><a href="cascades.html" data-scroll="cascades">Network Cascades</a></li>
<li><a href="epidemics.html" data-scroll="epidemics">Epidemics on Networks</a></li>
</ul>
</li>
</ul></nav><div class="extras"><nav><a class="pretext-link" href="https://pretextbook.org">Authored in PreTeXt</a><a href="https://www.mathjax.org"><img title="Powered by MathJax" src="https://www.mathjax.org/badge/badge.gif" alt="Powered by MathJax"></a></nav></div>
</div></div>
<main class="main"><div id="content" class="pretext-content"><section xmlns:svg="http://www.w3.org/2000/svg" class="section" id="modularity"><h2 class="heading hide-type">
<span class="type">Section</span> <span class="codenumber">1.3</span> <span class="title">Modularity</span>
</h2>
<section class="introduction" id="introduction-3"><p id="p-52">Suppose that we have a network that is partitioned into (potential) communities. The <em class="emphasis">type</em> of a vertex is the community \(C\) that it belongs to. The <em class="emphasis">modularity</em> of a network \(G\) is given by</p>
<div class="displaymath">
\begin{equation*}
Q  =  \frac{1}{2m} \sum_{i} \sum_{j} \left( A_{ij} - \frac{k_i k_j}{2m} \right) \delta (C^{(i)}, C^{(j)})
=  \frac{1}{2m} \sum_{C} \sum_{i \in C} \sum_{j \in C} \left( A_{ij} - \frac{k_i k_j}{2m} \right)
\end{equation*}
</div>
<p class="continuation">where</p>
<ul class="disc">
<li id="li-26"><p id="p-53">\(A\) is the adjacency matrix</p></li>
<li id="li-27"><p id="p-54">\(m\) is the number of edges in the network</p></li>
<li id="li-28"><p id="p-55">\(k_i\) is the degree of vertex \(i\)</p></li>
<li id="li-29"><p id="p-56">\(C^{(i)}\) is the <em class="emphasis">type</em> of vertex \(i\)</p></li>
<li id="li-30"><p id="p-57">\(\displaystyle \delta(x,y) = \left\{ \begin{array}{cc} 1 &amp; \mbox{if } x=y \\ 0 &amp;  \mbox{otherwise} \end{array} \right.\)</p></li>
</ul>
<p class="continuation">The modularity satisfies \(-1 &lt; Q &lt; 1\text{.}\) A modularity score of \(Q &gt; 0.3\) indicates significant community structure.</p></section><section class="exercises" id="exercises-3"><h3 class="heading hide-type">
<span class="type">Exercises</span> <span class="codenumber"></span> <span class="title">Practice Problems</span>
</h3>
<article class="exercise exercise-like" id="exercise-17"><h6 class="heading">
<span class="codenumber">1<span class="period">.</span></span><span class="space"> </span><span class="title">Modularity Calculation.</span>
</h6>
<p id="p-58">Consider the following network with \(V = \{ 1, 2, 3, 4 \}\) and \(E = \{ (1,2), (3,4) \}\text{.}\) Confirm that the modularity scores of the following four partitions by filling in the summands for \(1 \leq i,j \leq 4\text{.}\) Use this <a class="external" href="https://docs.google.com/spreadsheets/d/1kEP0CkUeG9s0RrJDtZcSmkDRKR7JWryNItu4b60pYYs/edit?usp=sharing" target="_blank">link to a Google Sheet</a> to speed up calculations. Pay attention to the modularity contributions for various pairs of nodes. In particular, when \(i\) and \(j\) are in different communities, the corresponding summand is zero.</p>
<ol class="lower-alpha">
<li id="li-31"><p id="p-59">A single community. <div class="image-box" style="width: 40%; margin-left: 30%; margin-right: 30%;"><img src="images/fig-img-modularity0.svg" role="img" class="contained"></div> </p></li>
<li id="li-32"><p id="p-60">Two communities with no external edges. <div class="image-box" style="width: 40%; margin-left: 30%; margin-right: 30%;"><img src="images/fig-img-modularity1.svg" role="img" class="contained"></div> </p></li>
<li id="li-33"><p id="p-61">Two communities with no internal edges. <div class="image-box" style="width: 40%; margin-left: 30%; margin-right: 30%;"><img src="images/fig-img-modularity2.svg" role="img" class="contained"></div> </p></li>
<li id="li-34"><p id="p-62">Two communities of sizes 3 and 1. <div class="image-box" style="width: 40%; margin-left: 30%; margin-right: 30%;"><img src="images/fig-img-modularity3.svg" role="img" class="contained"></div> </p></li>
</ol></article><article class="exercise exercise-like" id="exercise-18"><h6 class="heading">
<span class="codenumber">2<span class="period">.</span></span><span class="space"> </span><span class="title">Modularity Calculation for a Path.</span>
</h6>
<p id="p-63">Confirm the modularity scored  obtained by splitting the path \(P_4\) into the given communities.</p>
<ol class="lower-alpha">
<li id="li-35"><p id="p-64">A single community. <div class="image-box" style="width: 50%; margin-left: 25%; margin-right: 25%;"><img src="images/fig-img-modularity4.svg" role="img" class="contained"></div> </p></li>
<li id="li-36"><p id="p-65">Two communities separated by the most central edge. <div class="image-box" style="width: 50%; margin-left: 25%; margin-right: 25%;"><img src="images/fig-img-modularity5.svg" role="img" class="contained"></div> </p></li>
</ol></article><article class="exercise exercise-like" id="exercise-19"><h6 class="heading"><span class="codenumber">3<span class="period">.</span></span></h6>
<p id="p-66">Use this <a class="external" href="https://docs.google.com/spreadsheets/d/1kEP0CkUeG9s0RrJDtZcSmkDRKR7JWryNItu4b60pYYs/edit?usp=sharing" target="_blank">link to a Google Sheet</a> to explore the ways to partition graphs on four vertices. <em class="emphasis">You may add self-loops</em>, but such a loop corresponds to \(A_{ii}=2\) (so that the degrees are correct).</p>
<ol class="lower-alpha">
<li id="li-37"><p id="p-67">Can you find a graph and a partition with modularity greater than \(1/2\text{?}\) If not, why not? </p></li>
<li id="li-38"><p id="p-68">Can you find a graph and a partition with modularity less than \(-1/2\text{?}\) If not, why not? </p></li>
</ol></article><article class="exercise exercise-like" id="exercise-20"><h6 class="heading">
<span class="codenumber">4<span class="period">.</span></span><span class="space"> </span><span class="title">Understanding Modularity, Part I.</span>
</h6>
<p id="p-69">Modularity measures the extent to which edges are internal to communities, compared with spanning different communities. We will explain why this is the case. Basically, we are comparing the actual structure of the network with the expected structure of a network where we randomize the edges (but preserve the vertex degrees).</p>
<ol class="lower-alpha">
<li id="li-39">
<p id="p-70">Explain why the following expression counts the total number of edges</p>
<div class="displaymath">
\begin{equation*}
\frac{1}{2} \sum_{i}  \sum_{j}  A_{ij} 
\end{equation*}
</div>
</li>
<li id="li-40">
<p id="p-71">Now explain why the following expression counts the total number of edges that are <em class="emphasis">internal</em> to one of the designated communities.</p>
<div class="displaymath">
\begin{equation*}
\frac{1}{2}  \sum_{i}  \sum_{j} A_{ij}  \, \delta (C^{(i)}, C^{(j)})
\end{equation*}
</div>
<p class="continuation">which can also be written as</p>
<div class="displaymath">
\begin{equation*}
\frac{1}{2} \sum_{C} \sum_{i \in C} \sum_{j \in C} A_{ij}.
\end{equation*}
</div>
</li>
</ol></article><article class="exercise exercise-like" id="exercise-21"><h6 class="heading">
<span class="codenumber">5<span class="period">.</span></span><span class="space"> </span><span class="title">Understanding Modularity, Part II.</span>
</h6>
<p id="p-72">Now we will randomly rewire the network. We keep the ends of the edges, so that the vertex degrees do not change (see the figure to the right). We erase the edges themselves, which gives us a configuration like the one pictured to the right. Next, we randomly add edges between pairs of vertices, until all edges have been redrawn. Loops are allowed, as are multiple edges between pairs of vertices.</p>
<p id="p-73">Note that the degree of vertex \(i\) will still be \(k_i\) when this process is done. <div class="image-box" style="width: 40%; margin-left: 30%; margin-right: 30%;"><img src="images/rewire-vertex.png" class="contained"></div></p>
<ol class="lower-alpha">
<li id="li-41"><p id="p-74">Pick the start of one edge at vertex \(i\text{.}\) What is the probability that this rewired edge connects to vertex \(j\text{?}\) </p></li>
<li id="li-42"><p id="p-75">So how many rewired edges from vertex \(i\) do we expect to connect to vertex \(j\text{?}\) (Assume that the network is so big that the chance that two ends at \(i\) try to connect  to the same end at \(j\) is irrelevant.) </p></li>
<li id="li-43">
<p id="p-76">Now argue that the expected number of rewired edges that are internal to the specified communities is</p>
<div class="displaymath">
\begin{equation*}
\frac{1}{2} \sum_{i}  \sum_{j}  \frac{k_i k_j}{2m} \, \delta (C^{(i)}, C^{(j)})
\end{equation*}
</div>
<p class="continuation">which can also be written as</p>
<div class="displaymath">
\begin{equation*}
\frac{1}{2} \sum_{C} \sum_{i \in C} \sum_{j \in C}  \frac{k_i k_j}{2m}.		
\end{equation*}
</div>
<p class="continuation">Here, the \(\frac{1}{2}\) takes care of the double counting since our sum looks at the pair \(i,j\) twice. </p>
</li>
</ol>
<p class="continuation">We subtract the expression in question 4(c) from the expression in question 3(b). We then divide by the total number of edges \(m\) (a normalizing factor) to get the modularity</p>
<div class="displaymath">
\begin{equation*}
Q = \frac{1}{2m} \sum_{i}  \sum_{j}  \left( A_{ij} - \frac{k_i k_j}{2m} \right)\, \delta (C^{(i)}, C^{(j)}),
\end{equation*}
</div>
<p class="continuation">which can also be written as</p>
<div class="displaymath">
\begin{equation*}
Q = 	\frac{1}{2m} \sum_{C} \sum_{i \in C} \sum_{j \in C} \left( A_{ij} - \frac{k_i k_j}{2m} \right).	
\end{equation*}
</div></article><article class="exercise exercise-like" id="exercise-22"><h6 class="heading">
<span class="codenumber">6<span class="period">.</span></span><span class="space"> </span><span class="title">Modularity as a Random Walk Measure.</span>
</h6>
<p id="p-77">We can rewrite our modularity equation as</p>
<div class="displaymath">
\begin{equation*}
Q \, = \, \frac{1}{2m} \sum_{C} \sum_{i,j \in C} \left( A_{ij} - \frac{k_i k_j}{2m} \right) 
\,= \,  \sum_{C} \sum_{i,j \in C} \left( \frac{A_{ij}}{k_i} \frac{k_i}{2m}  - \frac{k_i }{2m} \frac{k_j }{2m}  \right)	
\end{equation*}
</div>
<ol id="p-78" class="lower-alpha">
<li id="li-44"><p id="p-derived-li-44">Confirm that this expression is equivalent to<div class="displaymath">
\begin{equation*}
Q \, = \, \sum_{C} \sum_{i,j \in C} \left( P^{\top}_{ij}\pi_i  - \pi_i \pi_j  \right)
\end{equation*}
</div>where \(P = D^{-1} A\) is the random walk transition matrix and \(\pi\) is its stationary distribution, where \(\pi_i=k_{i}/2m\text{.}\) </p></li>
<li id="li-45">
<p id="p-79">Consider a random walk whose distribution has converged to the stationary distribution \(\pi\text{.}\)</p>
<ol class="lower-roman">
<li id="li-46"><p id="p-derived-li-46">Explain why \(\sum_{i,j \in C} P^{\top}_{ij}\pi_i\) is the probability that we are in \(C\) at time \(t\) and \(t+1\text{.}\) </p></li>
<li id="li-47"><p id="p-derived-li-47">Explain why \(\sum_{i,j \in C}  \pi_i \pi_j\) is the probability that we are in \(C\) at time \(t\) and \(t+T\) for very large \(T\text{.}\) </p></li>
</ol>
</li>
<li id="li-48"><p id="p-derived-li-48">Modularity is the difference of the two quantities in part (b). Using this random walk interpretation, why is this difference a measure of community structure?</p></li>
</ol></article></section></section></div></main>
</div>
</body>
</html>
